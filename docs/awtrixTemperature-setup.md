# AWTRIX Temperature Display

Сценарий для отображения температуры с датчиков SprutHub на часах AWTRIX3.

## Возможности

- Отображение температуры со всех датчиков на всех часах AWTRIX
- Цвет текста меняется в зависимости от температуры
- Индивидуальные иконки для комнат (опционально)
- Автоматическое отключение встроенных приложений AWTRIX
- Настраиваемые пороги температуры

## Требования

- SprutHub с датчиками температуры (HS.TemperatureSensor)
- Часы Ulanzi TC001 с прошивкой [AWTRIX 3](https://blueforcer.github.io/awtrix3/#/)

## Установка

### 1. Настройка сценария

Откройте файл `logic/awtrixTemperature.js` и настройте константы:

#### Список часов AWTRIX

```javascript
const CLOCKS = [
    { name: "Кухня", ip: "192.168.1.65" },
    { name: "Спальня", ip: "192.168.1.66" }
];
```

#### Иконки по комнатам (опционально)

```javascript
const ROOM_ICONS = {
    "Улица": 4285,
    "Гараж": 2083,
};
```

Если для комнаты указана иконка — показывается `[иконка] 23°`.
Если иконка не указана — показывается `23° Улиц` (название до 4 символов).

Иконки загружаются через веб-интерфейс часов (раздел Icons).

#### Цвета температуры

```javascript
const COLORS = {
    VERY_COLD: "#9400D3",  // фиолетовый
    COLD: "#0000FF",       // синий
    COMFORT: "#00FF00",    // зелёный
    HOT: "#FF0000"         // красный
};
```

#### Пороги температуры

```javascript
const VERY_COLD_THRESHOLD = -20;  // ниже — фиолетовый
const COLD_THRESHOLD = -12;       // ниже — синий
const HOT_THRESHOLD = 10;         // выше — красный
```

#### Настройки яркости

```javascript
const AUTO_BRIGHTNESS = false;     // Автоматическая яркость
const MANUAL_BRIGHTNESS = 50;      // Ручная яркость (0-255)
```

#### Время отображения

```javascript
const APP_DISPLAY_TIME = 10;  // Секунды на каждое приложение
```

#### Время жизни приложения

```javascript
const APP_LIFETIME = 86400;  // 24 часа — удаляется если нет обновлений
```

#### Встроенные приложения AWTRIX

```javascript
const BUILTIN_APPS = {
    TIM: true,    // Время (рекомендуется оставить)
    DAT: false,   // Дата
    TEMP: false,  // Встроенная температура
    HUM: false,   // Влажность
    BAT: false    // Батарея
};
```

### 2. Добавление в SprutHub

1. Скопируйте содержимое `logic/awtrixTemperature.js`
2. В SprutHub создайте новый логический сценарий
3. Вставьте код сценария
4. Сохраните сценарий

### 3. Активация для датчиков

1. Перейдите в настройки датчика температуры
2. Включите сценарий "AWTRIX Temperature Display"
3. Повторите для всех датчиков температуры

## Формат отображения

**С иконкой** (комната есть в ROOM_ICONS):
```
[иконка] 23°
```

**Без иконки** (комнаты нет в ROOM_ICONS):
```
23° Спал
```

Название комнаты сокращается до 4 символов.

## Цветовая схема

- **Фиолетовый** — ниже -20°C (очень холодно)
- **Синий** — от -20°C до -12°C (холодно)
- **Зелёный** — от -12°C до 10°C (комфорт)
- **Красный** — выше 10°C (тепло/жарко)

*Пороги настраиваются в константах сценария.*

## Как работает сценарий

### При сохранении сценария

1. Применяются настройки на все часы (яркость, встроенные приложения)
2. Часы перезагружаются
3. Несколько секунд триггеры пропускаются (REBOOT_DELAY)

### При изменении температуры

1. Определяется цвет по температуре
2. Проверяется наличие иконки для комнаты
3. Формируется текст (с иконкой или названием)
4. Отправляется на все часы из CLOCKS

## Опции сценария

- **Отладка** (Boolean, по умолчанию: false) — включить логирование

## Устранение неполадок

### Приложение не появляется

1. Проверьте IP-адреса в CLOCKS
2. Убедитесь что часы доступны: `ping <IP>`
3. Включите опцию "Отладка"

### Иконка не отображается

1. Загрузите иконку через веб-интерфейс часов
2. Укажите правильный ID в ROOM_ICONS

### Температура не обновляется

1. Проверьте работу датчика в SprutHub
2. Убедитесь что сценарий включён для датчика

## Тестирование

```bash
node logic/test-runner.js
```

## Структура файлов

```
logic/
├── awtrixTemperature.js  # Сценарий
└── test-runner.js        # Тестовый раннер

docs/
├── awtrixTemperature-setup.md  # Документация
└── awtrixTemperature-tests.md  # Тесты
```
