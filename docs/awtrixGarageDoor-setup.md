# AWTRIX Garage Door Indicator

Сценарий для отображения статуса гаражных ворот на часах AWTRIX3.

## Возможности

- Мигающий красный индикатор при открытых воротах
- Поддержка до 3 индикаторов (по одному на каждые ворота)
- Отправка статуса на все часы AWTRIX
- Автоматический сброс индикаторов при сохранении сценария

## Требования

- SprutHub с гаражными воротами (HS.GarageDoorOpener)
- Часы Ulanzi TC001 с прошивкой [AWTRIX 3](https://blueforcer.github.io/awtrix3/#/)

## Установка

### 1. Настройка сценария

Откройте файл `logic/awtrixGarageDoor.js` и настройте константы:

#### Список часов AWTRIX

```javascript
const CLOCKS = [
    { name: "Кухня", ip: "192.168.1.65" },
    { name: "Спальня", ip: "192.168.1.66" }
];
```

Добавьте все ваши часы AWTRIX с их IP-адресами.

#### Цвет и эффект индикатора

```javascript
const INDICATOR_COLOR = [255, 0, 0];  // Красный (RGB)
const INDICATOR_FADE = 1000;           // Период мигания в мс
```

### 2. Добавление в SprutHub

1. Скопируйте содержимое `logic/awtrixGarageDoor.js`
2. В SprutHub создайте новый логический сценарий
3. Вставьте код сценария
4. Сохраните сценарий

### 3. Активация для ворот

1. Перейдите в настройки гаражных ворот (GarageDoorOpener)
2. Включите сценарий "AWTRIX Garage Door Indicator"
3. Выберите номер индикатора (1, 2 или 3)
4. Повторите для всех ворот, выбирая разные индикаторы

## Опции сценария

| Опция | Тип | Значения | Описание |
| ----- | --- | -------- | -------- |
| Номер индикатора | Список | 1, 2, 3 | Позиция индикатора на часах |
| Отладка | Boolean | true/false | Включить логирование |

## Как работает сценарий

### Состояния ворот

| Значение | Состояние | Индикатор |
| -------- | --------- | --------- |
| 0 | Открыто | Мигает красным |
| 1 | Закрыто | Выключен |
| 2 | Открывается | Мигает красным |
| 3 | Закрывается | Мигает красным |
| 4 | Остановлено | Мигает красным |

Индикатор горит пока ворота не полностью закрыты.

### Позиции индикаторов на AWTRIX

AWTRIX поддерживает 3 индикатора, расположенных в правом верхнем углу:

```
┌──────────────────────┐
│                  ●●● │  ← indicator1, indicator2, indicator3
│   23° Спальня        │
│                      │
└──────────────────────┘
```

### При сохранении сценария

Автоматически сбрасываются все 3 индикатора на всех часах.

### При изменении состояния ворот

1. Сценарий определяет нужен ли индикатор (всё кроме "закрыто")
2. Отправляет команду на все часы из списка CLOCKS
3. Индикатор включается/выключается мгновенно

## API AWTRIX

Сценарий использует [AWTRIX API](https://blueforcer.github.io/awtrix3/#/api):

```
POST http://<IP>/api/indicator<N>
```

Включить индикатор:
```json
{ "color": [255, 0, 0], "fade": 1000 }
```

Выключить индикатор:
```json
{}
```

## Устранение неполадок

### Индикатор не появляется

1. Проверьте IP-адрес часов в константе `CLOCKS`
2. Убедитесь что часы доступны: `ping <IP_часов>`
3. Включите опцию "Отладка" и проверьте логи SprutHub

### Индикатор не выключается

1. Убедитесь что ворота полностью закрыты (состояние = 1)
2. Проверьте что датчик состояния работает корректно
3. Сохраните сценарий заново (сбросит все индикаторы)

### Несколько ворот показывают один индикатор

Убедитесь что для каждых ворот выбран разный номер индикатора (1, 2 или 3).

## Тестирование

Тесты запускаются автоматически при каждом сохранении сценария.

Для локального тестирования:

```bash
cd /path/to/spruthub
node logic/test-runner.js
```

## Структура файлов

```
logic/
├── awtrixGarageDoor.js   # Сценарий индикатора ворот
├── awtrixTemperature.js  # Сценарий температуры
└── test-runner.js        # Тестовый раннер для Node.js

docs/
├── awtrixGarageDoor-setup.md   # Эта документация
└── awtrixTemperature-setup.md  # Документация температуры
```
